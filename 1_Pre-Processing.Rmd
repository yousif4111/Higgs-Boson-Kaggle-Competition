---
title: "Data Preprocessing"
author: "Yousif"
date: "01/31/2020"
output: html_document
---
This file contains the script used for Pre-Processing the data using the R language
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries
```{r }
library(tidyverse)
library(corrplot)
```


## Importing the data

```{r }
df = read.csv('Higg.csv')
colnames(df)[1] <- 'output'
names(df)
```
## Data Checking 
### Check missing value
```{r }
apply(is.na(df), 2, sum)

```

### check the data structure
```{r }
str(df)
df$jet4phi = as.numeric(df$jet4phi)
df$jet4b.tag=  as.numeric(df$jet4b.tag)
df$m_jj=as.numeric(df$m_jj)
df$m_jjj=as.numeric(df$m_jjj)
df$m_lv=as.numeric(df$m_lv)
df$m_jlv=as.numeric(df$m_jlv)
df$m_bb=as.numeric(df$m_bb)
df$m_wbb=as.numeric(df$m_wbb)
df$m_wwbb=as.numeric(df$m_wwbb)
df<-na.omit(df)

```

### check output composition
```{r }
prop.table(table(df$output))

```

## Check and remove outliers
```{r }
df2 = as.data.frame(scale(df[, - which(names(df)=='output')], center = TRUE, scale = TRUE))
summary(df2)[c(4),]


```
The outlier was removed using z-score 
```{r}
df3 = abs(df2)
df3 <- cbind (df3, df$output)
df4 <- filter_all(df3,all_vars(.<4))
print('number of row removed:')
print(dim(df)-dim(df4))
```
##Check and remove highly correlated data
```{r}
cortab <- cor(df4[, -which(names(df)=='output')])
corrplot(cortab, method = 'color')

```
## Train/Test/OOS Split
The data set will be splited into 2:
1.	Dataset with outliers remove.
2.	Dataset with outliers remain.

## Dataset, keep outliers
```{r}
set.seed(42)
temp <- sample(1:3,size=nrow(df),replace=TRUE,prob=c(0.7,0.15,0.15))
train_keep_outlier <- df[temp==1,]
test_keep_outlier <- df[temp==2,]
oos_keep_outlier <- df[temp==3,]

write.csv(train_keep_outlier,"train_keep_outlier.csv", row.names = FALSE)
write.csv(test_keep_outlier,"test_keep_outlier.csv", row.names = FALSE)
write.csv(oos_keep_outlier,"oos_keep_outlier.csv", row.names = FALSE)

```

## Dataset, remove outliers
```{r}
temp <- sample(1:3,size=nrow(df4),replace=TRUE,prob=c(0.7,0.15,0.15))
train_remove_outlier <- df4[temp==1,]
test_remove_outlier <- df4[temp==2,]
oos_remove_outlier <- df4[temp==3,]

write.csv(train_remove_outlier,"train_remove_outlier.csv", row.names = FALSE)
write.csv(test_remove_outlier,"test_remove_outlier.csv", row.names = FALSE)
write.csv(oos_remove_outlier,"oos_remove_outlier.csv", row.names = FALSE)

```
